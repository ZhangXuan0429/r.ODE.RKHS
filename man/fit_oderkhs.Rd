% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fit_oderkhs.R
\name{fit_oderkhs}
\alias{fit_oderkhs}
\title{Fit ODE-RKHS trajectories and extract alpha-coefficients}
\usage{
fit_oderkhs(data, vertex, group_label, sigma, lambda, gamma_init, time_points)
}
\arguments{
\item{data}{A list of length \code{n_time}; each element is a numeric matrix or
data frame of dimension \code{n_samples x n_taxa} for one time point, with row
names = sample IDs and column names = taxa/features.}

\item{vertex}{Character vector of taxa/features (column names) to fit.}

\item{group_label}{Character scalar; a label written into outputs for bookkeeping
(e.g., "Linear", "Exponential").}

\item{sigma}{Positive scalar; RBF kernel bandwidth.}

\item{lambda}{Positive scalar; base regularization strength.}

\item{gamma_init}{Positive scalar; initial ODE penalty weight.}

\item{time_points}{Numeric vector of length \code{n_time} with strictly increasing
observation times.}
}
\value{
A list with three data frames:
\describe{
\item{\code{alpha_df}}{Per-interval coefficients and derivative fits with columns:
\code{TimePair}, \code{x_prev}, \code{x_current}, \code{dx_dt}, \code{Ypred},
\code{Alpha}, \code{Sample}, \code{Species}, \code{Group}.}
\item{\code{ode_result}}{Reconstructed trajectories with columns:
\code{Time}, \code{Orig}, \code{Pred}, \code{Sample}, \code{Species}, \code{Group}.}
\item{\code{loss}}{Per subject–taxon MSEs and total loss with columns:
\code{mse_ypred}, \code{mse_ode}, \code{TotalLoss}, \code{Converged},
\code{Sample}, \code{Species}, \code{Group}.}
}
}
\description{
Fits ODE-RKHS per subject–taxon on panel data organized as a list of time points.
For each taxon and subject, it alternates an Euler trajectory update and a
kernel-ridge update of the state-to-rate mapping coefficients (alpha), following
Eqs. (1)–(9). Returns alpha features, reconstructed trajectories, and loss summaries.
}
\details{
Alternating scheme: explicit Euler trajectory update (Eq. 4), finite-difference
targets (Eq. 5), kernel ridge update of coefficients (Eqs. 6–7), with geometric
schedule for the ODE penalty and termination by relative field change (Eq. 8).
The composite loss follows Eq. (9). The first alpha is obtained via kernel ridge
from finite differences of the observed trajectory; no manual alpha initialization
is required.
}
\examples{
# Example using simulated data (see datasets in the package)
data(simudata_linear_exp)
df_lin <- subset(simudata_linear_exp, Group == "Linear")
tp_cols <- grep("^t\\\\d+$", names(df_lin), value = TRUE)
time_pts <- as.numeric(sub("^t", "", tp_cols))
data_list <- lapply(tp_cols, function(tt) {
  m <- as.matrix(df_lin[, tt, drop = FALSE])
  rownames(m) <- rownames(df_lin)
  colnames(m) <- "value"
  m
})
fit <- fit_oderkhs(
  data = data_list, vertex = "value", group_label = "Linear",
  sigma = 1, lambda = 1e-2, gamma_init = 1, time_points = time_pts
)
head(fit$alpha_df)

}
